<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<link rel="Stylesheet" type="text/css" href="../../static/css/style.css">
<link rel="Stylesheet" type="text/css" href="../../static/bootstrap-3.1.1/css/bootstrap.min.css">
<link rel="Stylesheet" type="text/css" href="../../static/css/wiki.css">

<script type="text/javascript" src="../../static/js/jquery-1.11.0.js"></script>
<script type="text/javascript" src="../../static/bootstrap-3.1.1/js/bootstrap.min.js"></script>

<script type="text/javascript" src="../../static/js/xregexp-all.js"></script> <!-- XRegExp is bundled with the final shCore.js during build -->
<!-- 利用pin.js使toc固定在屏幕左侧-->
<script type="text/javascript" src="../../static/js/jquery.pin.js"></script> 

<script type="text/javascript" src="../../static/js/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shLegacy.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushAppleScript.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushAS3.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushBash.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushColdFusion.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushCSharp.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushDelphi.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushDiff.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushErlang.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushGroovy.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushJavaFx.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushPerl.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushPlain.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushPowerShell.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushRuby.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushSass.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushScala.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushVb.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushXml.js"></script>
<!-- 自定义笔刷 -->
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushLaTex.js"></script>
<script type="text/javascript" src="../../static/js/syntaxhighlighter/shBrushVimScript.js"></script>
<!-- 加入数学公式的支持 -->
<script type="text/javascript" src="../../static/js/mathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<link type="text/css" rel="stylesheet" href="../../static/css/syntaxhighlighter/shCoreDefault.css"/>
<link type="text/css" rel="stylesheet" href="../../static/css/font-awesome.css"/>

<title>vimscript</title>
<!-- <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<div class="container">
<nav class="navbar navbar-inverse" role="navigation">
<div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand">Ollie's Wiki</a>
</div>
<div class="collapse navbar-collapse">
<ul class="nav navbar-nav">
<li><a href="../../index.html"><i class="icon-home"></i> Home</a></li>
<li><a href="../../NoteBook/index.html"><i class="icon-pencil"></i> NoteBook</a></li>
<li><a href="../../TodoList/index.html"><i class="icon-ok"></i> TodoList</a></li>
<li><a href="../../BookList/index.html"><i class="icon-book"></i> BookList</a></li>
<li><a href="../../diary/diary.html"><i class="icon-coffee"></i> Diary</a></li>
</ul>
</div>
</div>
</nav>
<div class="container content-body">
<div class="content">

<div class="toc">
<ul>
<li><a href="#toc_1">VimScript</a>
<ul>
<li><a href="#toc_1.1">打印</a>
<li><a href="#toc_1.2">设置</a>
<li><a href="#toc_1.3">映射</a>
<ul>
<li><a href="#toc_1.3.1">映射正常模式</a>
<li><a href="#toc_1.3.2">多种环境下的映射</a>
<li><a href="#toc_1.3.3">严格的映射</a>
<li><a href="#toc_1.3.4">&lt;leader&gt;组合映射</a>
</ul>
<li><a href="#toc_1.4">缩写</a>
<ul>
<li><a href="#toc_1.4.1">Buffer-Local</a>
<ul>
<li><a href="#toc_1.4.1.1">Buffer</a>
<li><a href="#toc_1.4.1.2">最佳实践</a>
<li><a href="#toc_1.4.1.3">Local</a>
</ul>
</ul>
<li><a href="#toc_1.5">自动执行命令</a>
<ul>
<li><a href="#toc_1.5.1">autocmd</a>
<ul>
<li><a href="#toc_1.5.1.1">例子</a>
<li><a href="#toc_1.5.1.2">最佳实践</a>
</ul>
<li><a href="#toc_1.5.2">autocmd group</a>
<ul>
<li><a href="#toc_1.5.2.1">最佳实践</a>
</ul>
</ul>
<li><a href="#toc_1.6">Operator-Pending Mapping</a>
<ul>
<li><a href="#toc_1.6.1">例子</a>
<ul>
<li><a href="#toc_1.6.1.1">Normal</a>
<li><a href="#toc_1.6.1.2">Execute</a>
</ul>
</ul>
<li><a href="#toc_1.7">状态栏</a>
<ul>
<li><a href="#toc_1.7.1">最佳实践</a>
</ul>
<li><a href="#toc_1.8">vimscript as language</a>
<ul>
<li><a href="#toc_1.8.1">varible和options</a>
<li><a href="#toc_1.8.2">Local options</a>
<li><a href="#toc_1.8.3">Register和变量</a>
<li><a href="#toc_1.8.4">变量范围</a>
</ul>
<li><a href="#toc_1.9">条件语句</a>
<ul>
<li><a href="#toc_1.9.1">多行语句</a>
<li><a href="#toc_1.9.2">If</a>
<li><a href="#toc_1.9.3">Else 与 Elseif</a>
</ul>
<li><a href="#toc_1.10">常用操作助记</a>
<li><a href="#toc_1.11">未完待续</a>
<li><a href="#toc_1.12">参考文献</a>
</ul>
</ul>
</div>
<h1 id="toc_1">VimScript</h1>
<h2 id="toc_1.1">打印</h2>
<p>
echo与echom同样可以在命令行中打印字符，但是echom打印的字符将可以使用命令messages调出，而echo的将会在脚本执行完毕就清除
</p>
<h2 id="toc_1.2">设置</h2>
<p>
设置有两种
</p>
<ul>
<li>
布尔值 值只有on,off

<li>
数值 值可以是一个数字

</ul>
<p>
设置属性方法：
</p>
 
<table>
<tr>
<th>
命令
</th>
<th>
含义
</th>
</tr>
<tr>
<td>
set number
</td>
<td>
设置为on
</td>
</tr>
<tr>
<td>
set nonumber
</td>
<td>
设置为off
</td>
</tr>
<tr>
<td>
set number?
</td>
<td>
查看当前值
</td>
</tr>
<tr>
<td>
set number!
</td>
<td>
反转为相反值
</td>
</tr>
</table>

<h2 id="toc_1.3">映射</h2>
<h3 id="toc_1.3.1">映射正常模式</h3>
<ul>
<li>
<code>:map \ dd</code> 正常模式下将<code>\</code>映射为<code>dd</code>

<li>
<code>:map &lt;space&gt; viw</code> 正常模式下将空格键映射为<code>viw</code>，选中一个词

<li>
<code>:map &lt;c-d&gt; dd</code> 正常模式下将<code>ctrl+d</code>映射为<code>dd</code>

</ul>
<p>
映射后面同行不能通过<code>"</code> 来加注释
</p>

<p>
<code>*unmap \</code>解除映射
</p>
<h3 id="toc_1.3.2">多种环境下的映射</h3>
<ul>
<li>
:nmap 正常模式下映射

<li>
:vmap 视图模式下映射

<ul>
<li>
<code>vmap \ U</code> 视图模式下，用<code>\</code>将所选字母变大写字母

</ul>
<li>
:imap 插入模式下映射

<ul>
<li>
<code>imap &lt;c-d&gt; &lt;esc&gt;ddi</code> 在插入模式下<code>ctrl+d</code>删除一行并进入插入模式

</ul>
</ul>

<h3 id="toc_1.3.3">严格的映射</h3>
<p>
映射可以传递，所以下面例子中<code>\</code>会执行<code>dd</code>操作
</p>
<pre class="brush:vimscript; toolbar:false">
" 这是注释
:nmap - dd
:nmap / -
</pre>
<p>
这会造成映射的迭代，如
</p>
<pre class="brush:vimscript; toolbar:false">
:nmap dd O&lt;esc&gt;jddk
</pre>
<p>
<code>dd</code>命令将会迭代执行
</p>

<p>
针对以上情况 
</p>
<pre class="brush:vimscript; toolbar:false">
:nnoremap dd O&lt;esc&gt;jddk
</pre>
<p>
阻止映射的传递，每一种<code>*map</code>都有对应的<code>*noremap</code>方法，日常应该使用<code>*noremap</code>方式
</p>
<h3 id="toc_1.3.4">&lt;leader&gt;组合映射</h3>
<p>
vim支持组合键映射如<code>nmap -d dd</code>
</p>
<ul>
<li>
前缀可以使用vim默认的<code>&lt;leader&gt;</code>表示

<li>
可以通过<code>let mapleader = "-"</code>将其设置为<code>-</code>

<li>
<code>let localleader="-"</code>可以设置针对某种文件类型时，<code>&lt;leader&gt;</code>的值

</ul>
<h2 id="toc_1.4">缩写</h2>
<ul>
<li>
将输入的<code>adn</code>变为<code>and</code>,用于纠错

<ul>
<li>
<code>:iabbrev adn and</code>

<li>
<code>:iabbrev taht that</code>

<li>
<code>:iabbrev waht what</code>

</ul>
<li>
缩略常用字串 

<ul>
<li>
<code>@@ boyu_liu1226@163.com</code> 

</ul>
</ul>
<p>
简写命令会在输入定义的单词后不是字母、数字、下划线是触发替换。这是它与映射的本质区别，映射将会将所以定义字符替换，而简写的触发是有条件的。
</p>

<h3 id="toc_1.4.1">Buffer-Local</h3>
<h4 id="toc_1.4.1.1">Buffer</h4>
<p>
可以通过<code>&lt;buffer&gt;</code>属性，定义仅对当前buffer生效的映射
</p>
<pre class="brush:vimscript; toolbar:false">
:nnoremap &lt;leader&gt;d dd	
:nnoremap &lt;buffer&gt; &lt;leader&gt;x dd
</pre>
<p>
如果重复定义，带<code>&lt;buffer&gt;</code>属性的，将会有更高执行优先级
</p>
<pre class="brush:vimscript; toolbar:false">
:nnoremap &lt;buffer&gt; Q x
:nnoremap Q dd
</pre>
<p>
当前buffer中<code>Q</code>执行<code>x</code>。
</p>
<h4 id="toc_1.4.1.2">最佳实践</h4>
<p>
定义仅限定为当前buffer的组合映射时，最好使用<code>&lt;localleader&gt;</code>而非<code>&lt;leader&gt;</code>，以此便于区分命令的使用范围
</p>
<h4 id="toc_1.4.1.3">Local</h4>
<p>
属性的设置也可以用<code>local</code>修饰，用于限定当前buffer
</p>
<pre class="brush:vimscript; toolbar:false">
:setlocal wrap
:setlocal nowrap
</pre>


<h2 id="toc_1.5">自动执行命令</h2>
<h3 id="toc_1.5.1">autocmd</h3>
<pre class="brush:vimscript; toolbar:false">
	:autocmd BufNewFile[,otherEvent] * :write
         ^         					 ^  	^
         |         					 |  	|
         |         					 |  	The command to run.
         |         					 |
         |         					 A "pattern" to filter the event.
         |
         The "event" to watch for.
</pre>
<p>
监控一种事件，在对面满足某种模式时，触发后面的命令
</p>

<p>
上面的例子表示：在buffer中创建一个文件时，即将其写入硬盘
</p>

<p>
<code>:autocmd BufNewFile *.txt :write</code>
表示在只针对以<code>.txt</code>结尾的文件，才直接保存
</p>
<h4 id="toc_1.5.1.1">例子</h4>
<pre class="brush:vimscript; toolbar:false">
" 写入html文件时，自动格式化
:autocmd BufWrite *.html :normal gg=G
" 读入和写入html时，自动格式化
:autocmd BufWrite,BufRead *.html :normal gg=G
" 读入和新建html时，设置当前buffer不能折行
:autocmd BufNewFile,BufRead *.html setlocal nowrap
" 如果文件类型为javascript，或python，当前buffer映射相应的注释符号
:autocmd FileType javascript nnoremap &lt;buffer&gt; &lt;localleader&gt;c I//
:autocmd FileType python     nnoremap &lt;buffer&gt; &lt;localleader&gt;c I#
</pre>
<h4 id="toc_1.5.1.2">最佳实践</h4>
<p>
结合对简写的<code>&lt;buffer&gt;</code>限定，对特定的文件类型进行定制化的简写替换
</p>
<pre class="brush:vimscript; toolbar:false">
:autocmd FileType javascript :iabbrev &lt;buffer&gt; iff if(){}&lt;left&gt;&lt;left&gt;&lt;left&gt;&lt;left&gt;&lt;left&gt;
:autocmd FileType python :iabbrev &lt;buffer&gt; iff if:&lt;left&gt;
</pre>
<h3 id="toc_1.5.2">autocmd group</h3>
<p>
每次<code>source $MYVIMRC</code>，都会运行一边<code>autocmd</code>定义，vim并不会覆盖原来的自动执行命令，而是生成两条同样的命令。久而久之影响效率。
</p>

<p>
利用<code>autocmd group</code>可以解决这个问题
</p>
<ul>
<li>
重复执行组定义，组会合并起来，保证只有一个组；

<li>
通过<code>autocmd!</code>命令可以清楚组内命令

</ul>
<h4 id="toc_1.5.2.1">最佳实践</h4>
<pre class="brush:vimscript; toolbar:false">
:augroup testgroup
:	autocmd!
:	autocmd BufWrite * :echom "Cats"
:augroup END
</pre>
<p>
以上例子中将每次合并<code>testgroup</code>，并删除里面的命令，重新定义，所以不会有重复
</p>

<h2 id="toc_1.6">Operator-Pending Mapping</h2>
<p>
自定义操作符截至位置映射
</p>
<pre class="brush:vimscript; toolbar:false">
:onoremap p i(
</pre>
<p>
<code>dp</code>=&gt;<code>di(</code>:删除括号中的内容
</p>
<pre class="brush:vimscript; toolbar:false">
:onoremap b /return&lt;cr&gt;
</pre>
<p>
<code>db</code>：删除从光标位置到<code>return</code>之前的字符
</p>

<h3 id="toc_1.6.1">例子</h3>
<pre class="brush:vimscript; toolbar:false">
" markdown写法中一行下面有多个=，表示这行是标题，而本映射就是选中所在段落的标题
:onoremap ih :&lt;c-u&gt;execute "normal! ?^==\\+$\r:nohlsearch\rkvg_"&lt;cr&gt;
</pre>
<p>
以上映射表示下面步骤
</p>
<ol>
<li>
?^==\\+$,查找有两个或两个以上<code>=</code>的模式

<li>
:nohlsearch，去除查找高亮

<li>
kvg_，视图模式选中上一行直到行尾

</ol>
<h4 id="toc_1.6.1.1">Normal</h4>
<p>
<code>normal</code>将后面的字符当做在正常模式的输入命令
</p>
<pre class="brush:vimscript; toolbar:false">
	:normal gg//相当于在普通模式下，直接输入gg
</pre>
<p>
<code>normal!</code>功能同上，但是，后面的输入中，如果有映射命令，不会执行映射
</p>

<h4 id="toc_1.6.1.2">Execute</h4>
<p>
<code>execute</code>将后面的字符串作为命令执行
</p>
<pre class="brush:vimscript; toolbar:false">
:execute "normal! gg"//作用同直接输入:normal! gg
</pre>
<p>
<code>execute</code>可以识别特殊字符如<code>&lt;cr&gt;</code>，会现将特殊字符替换命令
</p>
<pre class="brush:vimscript; toolbar:false">
:execute "normal! ?^==\\+$\r:nohlsearch\rkvg_"//在执行前，将会把\r替换为&lt;cr&gt;
</pre>


<h2 id="toc_1.7">状态栏</h2>
<p>
状态栏可以定义为这样
</p>
<pre class="brush:vimscript; toolbar:false">
:set statusline=%f\ -\ FileType:\ %y
</pre>
<p>
但是这样的定义很快就会由于过于复杂，而难以看明白，所以可以这样定义，更加清晰
</p>
<pre class="brush:vimscript; toolbar:false">
:set statusline=%f         " Path to the file
:set statusline+=\ -\      " Separator
:set statusline+=FileType: " Label
:set statusline+=%y        " Filetype of the file
"当然还有其他选项
:set statusline = %F	   " 显示完整路径，（小写是相对路径）
:set statusline = Current:\ %4l\ Total:\ %4L " %4l，表示当前行数按照4个字符宽度显示，效果Current:  12 Total:  20
:set statusline = Current:\ %-4l\ Total:\ %-4L " %4l，表示当前行数按照4个字符宽度显示，且占位空格靠右，效果Current:12  Total:20
:set statusline = Current:\ %04l\ Total:\ %04L " %4l，表示当前行数按照4个字符宽度显示，且用0占位，效果Current:0012  Total:0020

:set statusline+=%=        " Switch to the right side
</pre>
<h3 id="toc_1.7.1">最佳实践</h3>
<p>
可以通过<code>autocommands</code>,<code>setlocal</code>针对不同的文件类型定义不同的状态栏格式，当然注意将<code>autocommands</code>命令放入组中，一面重复加载
</p>

<hr />
<h2 id="toc_1.8">vimscript as language</h2>
<h3 id="toc_1.8.1">varible和options</h3>
<pre class="brush:vimscript; toolbar:false">
" 定义变量
:let foo="bar"

" 定义options
:set textwidth=80
" 前面加上&amp;表示要引用个option，而不是一个同名的变量
:echo &amp;textwidth
</pre>
<p>
任何非0的数表示true，0表示false
</p>
<pre class="brush:vimscript; toolbar:false">
" 布尔值options
" 显示0
:set nowarp
:echo &amp;warp
" 显示1
:set warp
:echo &amp;warp
</pre>
<p>
可以利用let设置options
</p>
<pre class="brush:vimscript; toolbar:false">
" 显示100
:let &amp;textwidth = 100
:set textwidth?
" 显示110
:let &amp;textwidth = &amp;textwidth + 10
:set textwidth?
</pre>
<h3 id="toc_1.8.2">Local options</h3>
<p>
利用set设置options只能将其设置为一个单一的值，
而是用let，将options当做一个变量来设置，即可充分利用脚本的运算能力，来决定options的值
</p>
<pre class="brush:vimscript; toolbar:false">
" 将一个option设置为一个局部变量，需要加上变量的前缀，表示本地变量（而非全局）
:let &amp;l:number = 1
" 在另一个buffer中如此设置，这两个将会有不同的行号显示结果
:let &amp;l:number = 0
</pre>

<p>
选择一个词，y
</p>
<pre class="brush:vimscript; toolbar:false">
" 显示你复制的东西，@"代表无名寄存器
:echo @"
</pre>

<p>
搜索一个词（\someword）
</p>
<pre class="brush:vimscript; toolbar:false">
" 显示someword
:echo @/
</pre>

<p>
以上方式可以帮助在程序中获得，修改复制和搜索的内容
</p>
<h3 id="toc_1.8.3">Register和变量</h3>
<pre class="brush:vimscript; toolbar:false">
" 向寄存器中，写入值
:let @a = "hello!"
" "ap 即可将寄存器a中hello！贴到编辑器中

" 读取寄存器的值
:echo @a
</pre>

<h3 id="toc_1.8.4">变量范围</h3>
<pre class="brush:vimscript; toolbar:false">
" 表示本变量范围在当前buffer
:let b:hello = "world"
:echo b:hello
</pre>

<h2 id="toc_1.9">条件语句</h2>
<h3 id="toc_1.9.1">多行语句</h3>
<p>
<code>|</code>表示管道操作，可以讲多条语句卸载一行执行
</p>
<pre class="brush:vimscript; toolbar:false">
" 表示依次执行两条语句
:echom "foo" | echom "bar"
</pre>
<h3 id="toc_1.9.2">If</h3>
<ul>
<li>
vim在有必要时会强制转换字符串与数字，例如当一个字符串与一个数字相加时

<li>
以数字开头的字符串将会转化为开头的数字，字符串开头，但后跟数字的字符串，将转化为0

<li>
对于非0数字，if判断为真，0则为假
<pre class="brush:vimscript; toolbar:false">
:echom "hello" + 10 
" 结果10
:echom "10hello" + 10 
" 结果 20
:echom "hello10" + 10 
" 结果10

" 将显示文字
:if "9024"
:    echom "WHAT?!"
:endif

" 不显示文字
:if "something"
:    echom "INDEED"
:endif
</pre>

</ul>

<h3 id="toc_1.9.3">Else 与 Elseif</h3>
<pre class="brush:vimscript; toolbar:false">
:if 0
:    echom "if"
:elseif "nope!"
:    echom "elseif"
:else
:    echom "finally!"
:endif
</pre>

<h2 id="toc_1.10">常用操作助记</h2>
<ul>
<li>
<code>ci(</code> 删除并更改括号里面的内容

<li>
<code>yt,</code> 复制直到逗号前的内容

<li>
<code>0</code> 光标移动到行的第一个字符

<li>
<code>g_</code> 光标移动到一行的最后一个非空字符，<code>$</code> 会移动到这一行的最后一个字符（即使最后一个字符是空格）

</ul>
<h2 id="toc_1.11">未完待续</h2>
<p>
No.22
</p>

<h2 id="toc_1.12">参考文献</h2>
<p>
<a href="http://learnvimscriptthehardway.stevelosh.com/">Learn vimscript the hard way</a>
</p>

</div>
</div>
<script type="text/javascript" src="../../static/js/wiki.js"></script>
</body>
</html>
